import React, {useState, useEffect} from "react";
import axios from "axios";

const useLoginForm = (callBack, validateLogin) => {
    // Register
    const [loginData, setLoginData] = useState({
        username: "",
        password: ""
    })


    const [errors, setErrors] = useState({})
    const [isSubmitting, setIsSubmitting] = useState(false);

    const loginChange = event => {
        const {id, value} = event.target;
        setLoginData({
            ...loginData,
            [id]: value
        });
    };


    const loginSubmit = async (event) => {
        event.preventDefault();

        setErrors(validateLogin(loginData));

        try {
            const result = await axios
                .post('http://localhost:8080/api/auth/signup',{
                    username: loginData.username,
                    password: loginData.password
                });
            console.log(result);
            // // localStorage.setItem("token", JSON.stringify(result.data.accessToken));
            // // localStorage.setItem("user_id", JSON.stringify(result.data.id));
            // props.history.push("/login");
        }
        catch (error) {

        }
        setIsSubmitting(true);
    };

    //useEffect checks of de errors veranderen
    useEffect(() => {
            //controleer of er geen errors zijn
            if (Object.keys(errors).length === 0 && isSubmitting){
                callBack();
            }
            //roep de callBack
        },

        //verander alleen als het object veranderd.
        [errors])

    return {loginChange, loginData, loginSubmit, errors};
};

export default useLoginForm;